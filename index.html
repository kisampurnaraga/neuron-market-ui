<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEURON STUDIO AI - GOLD ENGINE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        .font-mono-neuron { font-family: 'JetBrains Mono', monospace; }
        .glow-text { text-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        .status-running { box-shadow: 0 0 15px rgba(34, 197, 94, 0.4); animation: pulse-green 2s infinite; }
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); } 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); } }
    </style>
</head>
<body class="bg-[#020617] text-slate-300 min-h-screen p-4 md:p-10 font-sans">

    <div class="max-w-6xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-center mb-6 bg-slate-900/80 p-6 rounded-3xl border border-slate-800 backdrop-blur-md shadow-2xl">
            <div class="mb-4 md:mb-0 flex items-center gap-4">
                <div>
                    <h1 class="text-3xl font-black tracking-tighter text-blue-500 italic uppercase">Neuron AI</h1>
                    <div class="flex gap-2 mt-1"> 
                        <div class="bg-slate-800 border border-blue-500/30 px-3 py-1.5 rounded-xl flex items-center gap-2">
                            <span class="text-[10px] font-black text-white uppercase italic tracking-widest">üåï GOLD ENGINE ACTIVE</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex flex-wrap justify-center items-center gap-4">
                <div class="flex flex-col items-end px-4 border-r border-slate-800">
                    <span class="text-[9px] text-slate-500 font-bold uppercase tracking-widest">XAUUSD Live Price</span>
                    <span id="neuron-price" class="text-xl font-mono-neuron font-bold text-blue-400 glow-text">$0,000.00</span>
                </div>

                <div class="flex gap-2">
                    <button id="btn-gold" onclick="toggleScanner('gold')" class="px-6 py-2 text-[10px] font-black rounded-lg border border-slate-700 bg-slate-800/50 transition-all uppercase whitespace-nowrap">
                        START GOLD ENGINE
                    </button>
                </div>

                <a href="rekap.html" class="px-4 py-2 bg-slate-800 hover:bg-blue-600 text-slate-100 text-[10px] font-black rounded-xl border border-slate-700 transition-all uppercase">üìä Rekap</a>
            </div>
        </header>

        <div class="bg-slate-900/40 p-2 md:p-4 rounded-[2rem] border border-slate-800 shadow-inner relative z-0 mb-8">
            <div id="tradingview_neuron" class="h-[550px] w-full rounded-2xl overflow-hidden border border-slate-800"></div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="md:col-span-2 space-y-4">
                <div class="bg-slate-900/50 p-6 rounded-[2rem] border border-slate-800">
                    <h3 class="text-xs font-black uppercase text-slate-400 mb-2 tracking-widest">Intelligence Status</h3>
                    <p class="text-[11px] text-slate-500 leading-relaxed uppercase">
                        üöÄ <b>Mode:</b> High-Frequency Fractal Analysis. <br>
                        üì° <b>Feed:</b> Yahoo Finance (Stable Connectivity). <br>
                        ‚öñÔ∏è <b>Risk:</b> Safe SL Mode ($5.50 Distance).
                    </p>
                </div>
            </div>

            <div class="bg-slate-900/80 p-6 rounded-[2.5rem] border border-slate-800 shadow-2xl backdrop-blur-md">
                <h3 class="text-xs font-black uppercase tracking-[0.2em] text-blue-500 mb-6 flex items-center gap-2">
                    <span class="flex h-2 w-2 rounded-full bg-blue-500 animate-pulse"></span>
                    Gold Live Signals
                </h3>
                <div id="active-trades-list" class="space-y-4 max-h-[400px] overflow-y-auto pr-2 font-mono-neuron text-white">
                    <p class="text-slate-600 italic text-[10px]">Scanning markets...</p>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
    const API_BASE = "https://kisampurnaraga.pythonanywhere.com";
    const priceDisplay = document.getElementById('neuron-price');
    const btnGold = document.getElementById('btn-gold');

    function initChart() {
        new TradingView.widget({
            "autosize": true,
            "symbol": "OANDA:XAUUSD",
            "interval": "1",
            "timezone": "Asia/Jakarta",
            "theme": "dark",
            "style": "1",
            "locale": "en",
            "container_id": "tradingview_neuron",
            "studies": ["RSI@tv-basicstudies"],
            "hide_side_toolbar": false,
            "allow_symbol_change": false,
            "save_image": false
        });
    }

    async function syncDashboard() {
        try {
            // Hanya fetch Gold
            const res = await fetch(`${API_BASE}/scan/xauusd?t=${Date.now()}`);
            const data = await res.json();
            
            if (data.last_price > 0) {
                priceDisplay.innerText = `$${data.last_price.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            }

            // Update Button State
            if (btnGold.innerText !== "WAIT...") {
                if (data.running) {
                    btnGold.innerText = `üõë STOP GOLD ENGINE`;
                    btnGold.className = "px-6 py-2 bg-red-600 text-white border border-red-800 rounded-lg text-[10px] font-black hover:bg-red-700 transition-all cursor-pointer shadow-[0_0_15px_rgba(220,38,38,0.3)]";
                } else {
                    btnGold.innerText = `‚ö° START GOLD ENGINE`;
                    btnGold.className = "px-6 py-2 bg-slate-800/50 text-blue-400 border border-slate-700 rounded-lg text-[10px] font-black hover:bg-blue-600 hover:text-white transition-all cursor-pointer";
                }
            }

            renderSignals();
        } catch (e) { console.error("Sync Error", e); }
    }

    async function toggleScanner(mode) {
        const isRunning = btnGold.innerText.includes("STOP");
        const action = isRunning ? 'stop' : 'start';
        
        btnGold.innerText = "WAIT...";
        btnGold.disabled = true;

        try {
            await fetch(`${API_BASE}/scanner/${action}`, { method: 'POST' });
        } catch (e) {
            console.error("Toggle Error", e);
        } finally {
            setTimeout(() => {
                btnGold.disabled = false;
                syncDashboard();
            }, 2000);
        }
    }

    async function renderSignals() {
        try {
            const res = await fetch(`${API_BASE}/get-active-trades?t=${Date.now()}`);
            const trades = await res.json();
            const container = document.getElementById('active-trades-list');
            
            if (!trades || trades.length === 0) {
                container.innerHTML = '<p class="text-slate-600 italic text-[10px]">No Active Signals</p>';
                return;
            }

            container.innerHTML = ''; 
            // Hanya tampilkan yang pair-nya XAUUSD
            trades.filter(t => t.pair === 'XAUUSD').reverse().forEach(trade => {
                const isBuy = trade.type === 'BUY';
                const colorClass = isBuy ? "text-blue-400" : "text-orange-400";
                const borderClass = isBuy ? "border-blue-900/30" : "border-orange-900/30";

                container.innerHTML += `
                    <div class="bg-slate-800/40 p-4 rounded-2xl border ${borderClass} hover:border-slate-600 transition-all">
                        <div class="flex justify-between items-start mb-2">
                            <span class="${colorClass} font-black italic text-md">${trade.type} GOLD</span>
                            <span class="text-[8px] text-slate-600">${trade.time.split(' ')[1]}</span>
                        </div>
                        <div class="grid grid-cols-3 gap-1 bg-black/40 p-2 rounded-xl text-[10px] text-center font-mono-neuron">
                            <div><p class="text-[7px] text-slate-500 uppercase">Entry</p>${trade.entry}</div>
                            <div><p class="text-[7px] text-green-500 uppercase">TP</p>${trade.tp}</div>
                            <div><p class="text-[7px] text-red-500 uppercase">SL</p>${trade.sl}</div>
                        </div>
                    </div>
                `;
            });
        } catch (e) { }
    }

    window.onload = () => {
        initChart();
        syncDashboard();
        setInterval(syncDashboard, 5000);
    };
    </script>
</body>
</html>