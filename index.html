<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEURON STUDIO AI - Multi-Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        .font-mono-neuron { font-family: 'JetBrains Mono', monospace; }
        .glow-text { text-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        .crypto-card { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(10px); transition: all 0.3s ease; cursor: pointer; }
        .crypto-card:hover { border-color: #3b82f6; transform: translateY(-2px); }
        /* Style Dropdown Custom */
        .dropdown-content { display: none; position: absolute; background-color: #0f172a; min-width: 160px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.5); z-index: 1000; border-radius: 1rem; border: 1px solid #1e293b; overflow: hidden; }
        .dropdown-content button { color: #94a3b8; padding: 12px 16px; text-decoration: none; display: block; width: 100%; text-align: left; font-size: 11px; font-weight: bold; border-bottom: 1px solid #1e293b; }
        .dropdown-content button:hover { background-color: #3b82f6; color: white; }
        .dropdown:hover .dropdown-content { display: block; }
    </style>
</head>
<body class="bg-[#020617] text-slate-300 min-h-screen p-4 md:p-10 font-sans">

    <div class="max-w-6xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-center mb-6 bg-slate-900/80 p-6 rounded-3xl border border-slate-800 backdrop-blur-md shadow-2xl">
            <div class="mb-4 md:mb-0 flex items-center gap-4">
                <div>
                    <h1 class="text-3xl font-black tracking-tighter text-blue-500 italic uppercase">Neuron AI</h1>
                    <div class="dropdown relative mt-1">
                        <button class="bg-slate-800 border border-slate-700 px-3 py-1.5 rounded-xl flex items-center gap-2 hover:border-blue-500 transition-all">
                            <span id="current-asset-label" class="text-[10px] font-black text-white uppercase italic">GOLD (XAUUSD)</span>
                            <svg class="w-3 h-3 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="dropdown-content">
                            <button onclick="switchAsset('XAUUSD')">GOLD / XAUUSD</button>
                            <button onclick="switchAsset('BTC')">BITCOIN / BTC</button>
                            <button onclick="switchAsset('ETH')">ETHEREUM / ETH</button>
                            <button onclick="switchAsset('SOL')">SOLANA / SOL</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex flex-wrap justify-center items-center gap-4">
                <div id="gold-header-price" class="flex flex-col items-end px-4 border-r border-slate-800 cursor-pointer" onclick="switchAsset('XAUUSD')">
                    <span class="text-[9px] text-slate-500 font-bold uppercase tracking-widest">Main Engine (GOLD)</span>
                    <span id="neuron-price" class="text-xl font-mono-neuron font-bold text-blue-400 glow-text">$0000.00</span>
                </div>

                <div class="flex gap-2">
                    <button id="btn-control" onclick="toggleScanner('gold')" class="px-3 py-2 text-[9px] font-black rounded-lg border border-slate-700 bg-slate-800/50 hover:bg-blue-600 transition-all uppercase">Check Gold</button>
                    <button id="btn-crypto-control" onclick="toggleScanner('crypto')" class="px-3 py-2 text-[9px] font-black rounded-lg border border-slate-700 bg-slate-800/50 hover:bg-blue-600 transition-all uppercase">Check Crypto</button>
                </div>

                <a href="rekap.html" class="px-4 py-2 bg-slate-800 hover:bg-blue-600 text-slate-100 text-[10px] font-black rounded-xl border border-slate-700 transition-all uppercase">ðŸ“Š Rekap</a>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div onclick="switchAsset('BTC')" class="crypto-card p-4 rounded-2xl border border-slate-800 flex justify-between items-center">
                <div>
                    <p class="text-[9px] font-bold text-orange-500 uppercase">Bitcoin</p>
                    <p id="crypto-btc" class="text-lg font-mono-neuron text-white">$---</p>
                </div>
                <span class="text-slate-800 font-black">BTC</span>
            </div>
            <div onclick="switchAsset('ETH')" class="crypto-card p-4 rounded-2xl border border-slate-800 flex justify-between items-center">
                <div>
                    <p class="text-[9px] font-bold text-blue-400 uppercase">Ethereum</p>
                    <p id="crypto-eth" class="text-lg font-mono-neuron text-white">$---</p>
                </div>
                <span class="text-slate-800 font-black">ETH</span>
            </div>
            <div onclick="switchAsset('SOL')" class="crypto-card p-4 rounded-2xl border border-slate-800 flex justify-between items-center">
                <div>
                    <p class="text-[9px] font-bold text-purple-500 uppercase">Solana</p>
                    <p id="crypto-sol" class="text-lg font-mono-neuron text-white">$---</p>
                </div>
                <span class="text-slate-800 font-black">SOL</span>
            </div>
        </div>

        <div class="bg-slate-900/40 p-2 md:p-4 rounded-[2rem] border border-slate-800 shadow-inner">
            <div id="tradingview_neuron" class="h-[500px] w-full rounded-2xl overflow-hidden border border-slate-800"></div>
        </div>

        <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="md:col-span-2 space-y-4">
                <div class="bg-slate-900/50 p-6 rounded-[2rem] border border-slate-800">
                    <h3 class="text-xs font-black uppercase text-slate-400 mb-2 tracking-widest">System Intelligence</h3>
                    <p class="text-[11px] text-slate-500 leading-relaxed uppercase">
                        ðŸ’¡ <b>Click to switch:</b> Klik kotak harga Crypto atau menu dropdown di atas untuk mengganti tampilan chart secara instan.
                    </p>
                </div>
            </div>

            <div class="bg-slate-900/80 p-6 rounded-[2.5rem] border border-slate-800 shadow-2xl backdrop-blur-md">
                <h3 class="text-xs font-black uppercase tracking-[0.2em] text-blue-500 mb-6 flex items-center gap-2">
                    <span class="flex h-2 w-2 rounded-full bg-blue-500 animate-pulse"></span>
                    Signals
                </h3>
                <div id="active-trades-list" class="space-y-4 max-h-[400px] overflow-y-auto pr-2">
                    <p class="text-slate-600 italic text-[10px]">Syncing...</p>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
    const API_BASE = "https://kisampurnaraga.pythonanywhere.com";
    const priceDisplay = document.getElementById('neuron-price');
    const assetLabel = document.getElementById('current-asset-label');
    const btnControl = document.getElementById('btn-control');
    const btnCrypto = document.getElementById('btn-crypto-control');

    let currentSymbol = ""; 

    // FUNGSI PINDAH ASSET (Dropdown & Klik)
    function switchAsset(asset) {
        let tvSymbol = "";
        let displayLabel = "";

        if (asset.includes("XAU") || asset === "GOLD") {
            tvSymbol = "OANDA:XAUUSD";
            displayLabel = "GOLD (XAUUSD)";
        } else if (asset.includes("BTC")) {
            tvSymbol = "BINANCE:BTCUSDT";
            displayLabel = "BITCOIN (BTC)";
        } else if (asset.includes("ETH")) {
            tvSymbol = "BINANCE:ETHUSDT";
            displayLabel = "ETHEREUM (ETH)";
        } else if (asset.includes("SOL")) {
            tvSymbol = "BINANCE:SOLUSDT";
            displayLabel = "SOLANA (SOL)";
        }

        if (currentSymbol === tvSymbol) return; 
        currentSymbol = tvSymbol;
        assetLabel.innerText = displayLabel;

        document.getElementById('tradingview_neuron').innerHTML = ""; // Clear
        
        new TradingView.widget({
            "autosize": true,
            "symbol": tvSymbol,
            "interval": "15",
            "timezone": "Asia/Jakarta",
            "theme": "dark",
            "style": "1",
            "locale": "en",
            "container_id": "tradingview_neuron",
            "studies": ["RSI@tv-basicstudies", "BB@tv-basicstudies"],
            "hide_side_toolbar": false,
            "allow_symbol_change": false, // Lock agar user pakai dropdown kita
            "save_image": false
        });
    }

    // Load Awal
    window.onload = () => {
        switchAsset("XAUUSD");
        syncDashboard();
    };

    async function syncDashboard() {
        try {
            const [resGold, resCrypto] = await Promise.all([
                fetch(`${API_BASE}/scan/xauusd?t=${Date.now()}`),
                fetch(`${API_BASE}/scan/crypto?t=${Date.now()}`)
            ]);
            
            const dataGold = await resGold.json();
            const dataCrypto = await resCrypto.json();

            // Status Tombol
            updateBtn(btnControl, dataGold.running, "GOLD");
            updateBtn(btnCrypto, dataCrypto.running, "CRYPTO");

            // Header Selalu GOLD
            if (dataGold.last_price > 0) {
                priceDisplay.innerText = `$${dataGold.last_price}`;
            }

            // Ticker Crypto
            if (dataCrypto.prices) {
                document.getElementById('crypto-btc').innerText = `$${dataCrypto.prices.BTC.toLocaleString()}`;
                document.getElementById('crypto-eth').innerText = `$${dataCrypto.prices.ETH.toLocaleString()}`;
                document.getElementById('crypto-sol').innerText = `$${dataCrypto.prices.SOL.toLocaleString()}`;
            }

            renderSignals();
        } catch (e) { console.error("Sync Error", e); }
    }

    function updateBtn(btn, isRunning, label) {
        btn.innerText = isRunning ? `ðŸ›‘ STOP ${label}` : `âš¡ START ${label}`;
        btn.className = isRunning 
            ? "px-3 py-2 bg-red-900/20 text-red-500 border border-red-800 rounded-lg text-[9px] font-black hover:bg-red-500 hover:text-white transition-all cursor-pointer uppercase"
            : "px-3 py-2 bg-green-900/20 text-green-500 border border-green-800 rounded-lg text-[9px] font-black hover:bg-green-500 hover:text-white transition-all cursor-pointer uppercase";
    }

    async function renderSignals() {
        try {
            const [res1, res2] = await Promise.all([
                fetch(`${API_BASE}/get-active-trades?t=${Date.now()}`),
                fetch(`${API_BASE}/get-crypto-trades?t=${Date.now()}`)
            ]);
            const goldTrades = await res1.json();
            const cryptoTrades = await res2.json();
            const allTrades = [...goldTrades, ...cryptoTrades];
            const container = document.getElementById('active-trades-list');
            
            if (allTrades.length === 0) {
                container.innerHTML = '<p class="text-slate-600 italic text-[10px] animate-pulse">Waiting for confluence...</p>';
                return;
            }

            container.innerHTML = ''; 
            allTrades.forEach(trade => {
                const typeClass = trade.type === 'BUY' ? "text-blue-400" : "text-orange-400";
                container.innerHTML += `
                    <div onclick="switchAsset('${trade.pair}')" class="bg-slate-800/60 p-4 rounded-3xl border border-slate-700/50 hover:border-blue-500 transition-all duration-300 cursor-pointer">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <span class="text-[8px] text-slate-500 font-black block uppercase">${trade.pair}</span>
                                <span class="${typeClass} font-black italic text-md">${trade.type}</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-3 gap-1 bg-black/30 p-2 rounded-xl text-[9px] text-center font-mono-neuron">
                            <div><p class="text-[6px] text-slate-500">ENT</p>${trade.entry}</div>
                            <div><p class="text-[6px] text-green-500">TP</p>${trade.tp}</div>
                            <div><p class="text-[6px] text-red-500">SL</p>${trade.sl}</div>
                        </div>
                    </div>
                `;
            });
        } catch (e) { console.log("Signal Error", e); }
    }

    async function toggleScanner(mode) {
        const btn = mode === 'gold' ? btnControl : btnCrypto;
        const action = btn.innerText.includes("STOP") ? 'stop' : 'start';
        btn.innerText = "WAIT...";
        await fetch(`${API_BASE}/${mode === 'gold' ? 'scanner' : 'crypto-scanner'}/${action}`, { method: 'POST' });
        setTimeout(syncDashboard, 1500);
    }

    setInterval(syncDashboard, 5000);
    </script>
</body>
</html>